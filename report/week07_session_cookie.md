# 세션과 쿠키 기반 인증 흐름 이해

웹 애플리케이션에서 사용자 인증을 구현하는 것은 매우 중요합니다. 사용자 인증은 사용자가 누구인지 확인하고, 해당 사용자에게 적절한 권한을 부여하여 데이터에 접근할 수 있도록 하는 과정입니다. 이때 주로 사용되는 두 가지 상태 유지 전략이 **세션(Session)**과 **쿠키(Cookie)**입니다.

---

## 📌 상태 유지 전략: 세션 vs 쿠키

웹은 기본적으로 무상태(Stateless) 프로토콜인 HTTP를 기반으로 합니다. 이는 서버가 클라이언트의 이전 요청에 대한 정보를 기억하지 못한다는 의미입니다. 하지만 사용자 로그인 상태 유지와 같은 연속적인 서비스 제공을 위해서는 클라이언트의 상태를 유지할 필요가 있습니다. 이를 위해 세션과 쿠키가 활용됩니다.

---

## 🍪 쿠키 (Cookie)

쿠키는 클라이언트(브라우저) 측에 저장되는 작은 데이터 조각입니다. 서버가 클라이언트에게 쿠키를 전송하면, 클라이언트는 해당 쿠키를 저장하고 이후 동일한 서버로 요청을 보낼 때마다 이 쿠키를 함께 전송합니다.

### ✅ 특징
- **저장 위치**: 클라이언트(브라우저)
- **데이터 형식**: Key-Value 형태의 문자열
- **보안**: 클라이언트 측에 저장되므로 위변조에 취약. 민감한 정보 직접 저장 부적합
- **용량 제한**: 일반적으로 개당 4KB, 도메인당 20개 정도의 제한
- **사용 예시**: 로그인 유지, 장바구니, 사용자 설정(테마 등), 광고 추적

### ⚙️ 작동 흐름
1. 클라이언트가 로그인 요청을 보냅니다.
2. 서버는 인증 후 쿠키를 생성하고 `Set-Cookie` 응답 헤더를 통해 전송합니다.
3. 클라이언트는 쿠키를 저장합니다.
4. 이후 동일한 서버에 요청 시 `Cookie` 헤더에 포함되어 전송됩니다.
5. 서버는 이 쿠키를 사용해 클라이언트를 식별합니다.

---

## 🗂️ 세션 (Session)

세션은 서버 측에 사용자 정보를 저장하는 방식입니다. 서버는 사용자 로그인 시 고유한 세션 ID를 생성하고, 이를 클라이언트에게 쿠키 형태로 전송하거나 URL 파라미터 등으로 전달합니다.

### ✅ 특징
- **저장 위치**: 서버
- **보안**: 사용자 정보가 서버에 저장되어 쿠키보다 보안에 강함
- **용량**: 서버 메모리나 DB를 사용하므로 저장 용량이 큼
- **사용 예시**: 로그인 상태 유지, 장바구니, 민감한 정보 저장

### ⚙️ 작동 흐름
1. 클라이언트가 로그인 요청을 보냅니다.
2. 서버는 인증 후 사용자 정보를 **세션 저장소(메모리, DB 등)**에 저장하고 고유한 세션 ID를 생성합니다.
3. 서버는 세션 ID를 담은 쿠키(`Set-Cookie: JSESSIONID=...`)를 클라이언트에게 전송합니다.
4. 클라이언트는 쿠키를 저장합니다.
5. 이후 요청마다 해당 쿠키를 자동으로 전송합니다.
6. 서버는 세션 저장소에서 세션 ID에 해당하는 사용자 정보를 조회하여 처리합니다.

---

## 🧩 로그인 구조 적용 예시 (세션-쿠키 혼합 방식)

### 로그인 흐름
1. **클라이언트**: 사용자 ID와 비밀번호 입력 후 로그인 요청 (`POST` 전송)
2. **서버**:
   - DB에서 인증 확인
   - 세션 저장소에 사용자 정보 저장
   - 세션 ID 생성
   - `Set-Cookie` 헤더를 통해 세션 ID 쿠키 전송
3. **클라이언트**:
   - 받은 세션 ID 쿠키를 브라우저에 저장

### 이후 요청
- 클라이언트는 저장된 쿠키(`JSESSIONID`)를 HTTP 요청에 자동으로 포함
- 서버는 세션 저장소에서 사용자 정보 조회 후 처리

### 로그아웃
- 클라이언트가 로그아웃 요청
- 서버는 세션을 무효화 (`invalidate`)
- 쿠키 삭제 명령 (만료 시간 = 과거로 설정)

---

## ✅ 요약: 세션 vs 쿠키 비교표

| 항목        | 세션 (Session)         | 쿠키 (Cookie)             |
|-------------|------------------------|---------------------------|
| 저장 위치   | 서버                   | 클라이언트(브라우저)     |
| 보안        | 비교적 안전             | 위·변조 위험 있음         |
| 용량        | 서버 메모리 또는 DB     | 4KB 이내, 개수 제한 있음  |
| 유지 기간   | 일반적으로 브라우저 종료 시 만료 | 설정에 따라 유지 가능     |
| 사용 용도   | 로그인 상태, 민감정보 저장 | 로그인 유지, 사용자 설정 등 |

---

## 📎 참고
- 세션 ID는 보통 브라우저 쿠키를 통해 전달됨 (`JSESSIONID`)
- 쿠키 기반 인증은 토큰 기반 인증(JWT 등)에도 활용됨
- HTTPS 환경에서 `Secure`, `HttpOnly`, `SameSite` 속성을 꼭 설정하는 것이 보안에 좋음

